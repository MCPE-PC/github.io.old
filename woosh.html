---
layout: default
title: Woosh! - WhatThePage?
---
<header><h1>Woosh!</h1></header>
<noscript><h2>Please enable javascript first!</h2></noscript>
<div id="woosh" style="display: none;">
    <h2>Professional Hackers' Panel. Woosh...!</h2>
    <p align="center"><b>Status: <span id="status">None</span></b></p>
    <p align="right">My woosh timeout: <span id="timeout">-</span>s</p>
    <h3>Numbers Gallery</h3>
    <div id="gallery" style="margin: 0; padding: 0; width: 25%; border: 1px solid black; border-radius: 15px;">
        Try Woosh!
    </div>
</div>
<script>
  let currentStack = [-1, -1];
  let pause = false;
  let state = 0;
  let timeout = 0;
  let wooshStacks = [];

  window.onload = () => {
    document.getElementById('woosh').style.display = 'block';
    doWoosh();
  };
  
  window.onbeforeunload = event => {
    event.preventDefault();
    pause = true;

    if (state === 1) {
      event.returnValue = 'Do you really believe, leaving now is all right?';
    } else {
      doWoosh();
    }
  };

  setInterval(() => {
    if (timeout > 0) {
      timeout -= 1;
      document.getElementById('timeout').textContent = timeout.toString();

      if (timeout === 0 && state !== 1) {
        doWoosh();
      }
    }
  }, 1000);
  
  function doWoosh() {
    document.body.display = 'none';
    state = 1;

    for (let i = Math.floor(Math.random() * 1801) + 200; i > 0; i -= 1) {
      if (pause) {
        waitPaused();
      }

      stack(i);
      document.getElementById('status').textContent = 'Wooshing' + '.'.repeat(i);

      if (!window.confirm('Your favorite number is ' + i + '. Am I right?')) {
        window.alert('Gosh!');
        doWoosh();
        return;
      }
    }

    stack(-1);
    document.getElementById('status').textContent = 'Absolutely completed';
    document.body.display = 'block';
    state = 2;
    timeout = 600;
  }

  function stack(i) {
    if (i === currentStack[1] - 1) {
      currentStack[1] -= 1;
    } else {
      if (currentStack[0] >= 0) {
        wooshStacks.push(currentStack);
      }

      currentStack = [i, i];
    }
  }
  
  function waitPaused() {
    if (state === 1) {
      document.getElementById('status').textContent = 'Wooshing, paused <a onclick="paused = false;">[Resume now]</a>';
    }
    for (;;) {
      if (!pause) {
        return;
      }
    }
  }
</script>
